<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Earth — Explorer</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#071418; --card:#0c2426; --muted:#9fdad1; --accent:#66e0c1;
    --glass: rgba(255,255,255,0.04);
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;color:#e6fbf6;background:linear-gradient(180deg,#041517 0%, #031217 60%);-webkit-font-smoothing:antialiased}
  header{position:fixed;left:0;right:0;top:0;height:64px;display:flex;align-items:center;justify-content:space-between;padding:12px 28px;backdrop-filter:blur(6px);z-index:40;border-bottom:1px solid var(--glass)}
  header h1{margin:0;font-weight:600;font-size:16px;letter-spacing:0.2px}
  header nav{display:flex;gap:12px}
  header a{color:var(--muted);text-decoration:none;font-size:13px;padding:8px;border-radius:6px}
  header a:hover{background:rgba(255,255,255,0.02)}
  main{padding-top:84px;display:flex;flex-direction:column;gap:48px;align-items:center;padding-bottom:48px}
  .sections{width:1060px;max-width:94%;display:grid;grid-auto-rows:minmax(320px,auto);gap:28px}
  section.card{background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));border-radius:12px;padding:20px;border:1px solid var(--glass);box-shadow:0 10px 30px rgba(0,0,0,0.6)}
  .hero{display:grid;grid-template-columns:1fr 420px;gap:22px;align-items:center;min-height:420px}
  .hero .left h2{margin:0 0 8px 0;font-size:22px}
  .hero .left p{margin:0;color:rgba(230,251,246,0.88);line-height:1.45}
  .image-frame{position:relative;height:420px;border-radius:10px;overflow:hidden;background:#000;border:1px solid rgba(255,255,255,0.03)}
  .image-frame img{width:100%;height:100%;object-fit:cover;display:block;transform-origin:center center;transition:transform .45s ease}
  .meta{font-size:13px;color:var(--muted);margin-top:8px}
  .panel{padding:14px;background:rgba(0,0,0,0.12);border-radius:8px}
  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
  .btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:8px;color:var(--muted);cursor:pointer}
  .btn.primary{border-color:var(--accent);color:var(--accent)}
  /* Smooth reveal on scroll */
  .reveal{opacity:0;transform:translateY(8px);transition:opacity .7s ease,transform .7s ease}
  .reveal.visible{opacity:1;transform:none}
  /* gallery thumbnails */
  .thumbs{display:flex;gap:8px;margin-top:12px}
  .thumbs img{width:96px;height:64px;object-fit:cover;border-radius:6px;border:1px solid rgba(255,255,255,0.04);cursor:pointer}
  footer{display:flex;justify-content:space-between;align-items:center;margin-top:8px;color:rgba(255,255,255,0.6);font-size:13px;padding:12px 28px}
  /* zoom modal */
  .zoom-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(rgba(0,0,0,0.8),rgba(0,0,0,0.88));z-index:90}
  .zoom-card{width:90%;max-width:1200px;height:78%;background:#000;border-radius:10px;overflow:hidden;position:relative;border:1px solid rgba(255,255,255,0.06)}
  .zoom-card img{position:absolute;left:0;top:0;user-select:none;touch-action:none}
  .zoom-close{position:absolute;right:12px;top:12px;background:rgba(255,255,255,0.04);border:0;padding:8px;border-radius:6px;color:#fff;cursor:pointer}
  /* small screens */
  @media(max-width:980px){.hero{grid-template-columns:1fr;}.image-frame{height:320px}.zoom-card{height:84%}}
</style>
</head>
<body>
  <header>
    <h1>Earth — Professional Explorer</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="#" id="toOverview">Overview</a>
      <a href="#surface">Surface</a>
      <a href="#missions">Missions</a>
      <a href="#gallery">Gallery</a>
    </nav>
  </header>

  <main>
    <div class="sections">
      <!-- Overview -->
      <section class="card hero reveal" id="overview">
        <div class="left">
          <h2>Earth — a high-fidelity photographic overview</h2>
          <p>
            High-resolution imagery from NASA missions and public-domain archives.
            Use the images to zoom into surface features, inspect cloud structures, and view mission landing regions.
          </p>
          <div class="meta">Image credit: NASA / Apollo 17</div>
          <div class="grid-2" style="margin-top:14px">
            <div class="panel">
              <strong>Quick facts</strong>
              <div style="margin-top:8px;font-size:14px;color:var(--muted)">
                Radius: 6,371 km<br>
                Atmosphere: N₂ 78%, O₂ 21%<br>
                Day: ~23h56m
              </div>
            </div>
            <div class="panel">
              <strong>Tools</strong>
              <div style="margin-top:8px;display:flex;gap:8px">
                <button class="btn primary" id="openHero">Open Image</button>
                <button class="btn" id="scrollSurface">Go to Surface</button>
              </div>
            </div>
          </div>
        </div>

        <div class="image-frame" aria-hidden="false">
          <!-- public domain Apollo 17 image -->
          <img id="heroImg" src="https://upload.wikimedia.org/wikipedia/commons/9/97/The_Earth_seen_from_Apollo_17.jpg" alt="Earth" />
        </div>
      </section>

      <!-- Surface -->
      <section class="card reveal" id="surface">
        <h3 style="margin:0 0 12px 0">Surface — zoom & inspect</h3>
        <p style="margin:0 0 12px 0;color:var(--muted)">A single, extremely high-resolution photomosaic gives zoom detail. Click a thumbnail to open a zoomed viewer with pan & wheel-zoom controls (professional-grade).</p>

        <div style="display:flex;gap:12px;align-items:flex-start">
          <div style="flex:1">
            <div class="image-frame" style="height:420px">
              <img src="https://eoimages.gsfc.nasa.gov/images/imagerecords/74000/74022/world.topo.bathy.200412.3x21600x10800.jpg" alt="Earth topography" id="surfaceImg" style="transform:scale(1)">
            </div>
            <div class="thumbs" style="margin-top:10px">
              <img src="https://eoimages.gsfc.nasa.gov/images/imagerecords/74000/74022/world.topo.bathy.200412.3x21600x10800.jpg" data-src="https://eoimages.gsfc.nasa.gov/images/imagerecords/74000/74022/world.topo.bathy.200412.3x21600x10800.jpg">
              <img src="https://eoimages.gsfc.nasa.gov/images/imagerecords/73000/73867/earth_at_night_2012_lrg.jpg" data-src="https://eoimages.gsfc.nasa.gov/images/imagerecords/73000/73867/earth_at_night_2012_lrg.jpg">
              <img src="https://eoimages.gsfc.nasa.gov/images/imagerecords/57000/57730/global_true_color.jpg" data-src="https://eoimages.gsfc.nasa.gov/images/imagerecords/57000/57730/global_true_color.jpg">
            </div>
          </div>

          <aside style="width:360px">
            <div class="panel">
              <strong>Cloud overlay</strong>
              <p style="color:var(--muted);margin:8px 0 0 0">Toggle a semi-transparent cloud layer derived from satellite composites.</p>
              <div style="margin-top:10px;display:flex;gap:8px">
                <button class="btn" id="toggleCloud">Toggle Clouds</button>
                <button class="btn" id="openSurfaceZoom">Open Zoom</button>
              </div>
            </div>

            <div class="panel" style="margin-top:12px">
              <strong>Inspect</strong>
              <p style="color:var(--muted);margin:6px 0 0 0">Click the thumbnails to preview different datasets (topography, night lights, true color).</p>
            </div>
          </aside>
        </div>
      </section>

      <!-- Missions -->
      <section class="card reveal" id="missions">
        <h3 style="margin:0 0 12px 0">Missions & observations</h3>
        <p style="margin:0 0 12px 0;color:var(--muted)">Selected missions and sensors that produced the source imagery.</p>

        <div style="display:flex;gap:12px;flex-wrap:wrap">
          <div class="panel" style="flex:1">
            <strong>Satellites</strong>
            <ul style="color:var(--muted);margin:8px 0 0 0">
              <li>MODIS (Terra/Aqua)</li>
              <li>Landsat</li>
              <li>Suomi NPP (VIIRS)</li>
            </ul>
          </div>
          <div class="panel" style="width:360px">
            <strong>Data timeline</strong>
            <div style="margin-top:8px;color:var(--muted);font-size:14px">
              1972 — Landsat 1<br>
              1999 — Terra (MODIS)<br>
              2011 — Suomi NPP (VIIRS)
            </div>
          </div>
        </div>
      </section>

      <!-- Gallery -->
      <section class="card reveal" id="gallery">
        <h3 style="margin:0 0 12px 0">Gallery</h3>
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px">
          <div class="panel" style="padding:0;overflow:hidden;border-radius:8px">
            <img src="https://eoimages.gsfc.nasa.gov/images/imagerecords/73000/73867/earth_at_night_2012_lrg.jpg" style="width:100%;height:240px;object-fit:cover;display:block;cursor:pointer" class="zoomable" data-title="Earth at Night — VIIRS">
          </div>
          <div class="panel" style="padding:0;overflow:hidden;border-radius:8px">
            <img src="https://eoimages.gsfc.nasa.gov/images/imagerecords/74000/74022/world.topo.bathy.200412.3x21600x10800.jpg" style="width:100%;height:240px;object-fit:cover;display:block;cursor:pointer" class="zoomable" data-title="Global Topography">
          </div>
          <div class="panel" style="padding:0;overflow:hidden;border-radius:8px">
            <img src="https://eoimages.gsfc.nasa.gov/images/imagerecords/57000/57730/global_true_color.jpg" style="width:100%;height:240px;object-fit:cover;display:block;cursor:pointer" class="zoomable" data-title="True Color Composite">
          </div>
        </div>
      </section>
    </div>
  </main>

  <div class="zoom-modal" id="zoomModal" aria-hidden="true">
    <div class="zoom-card" role="dialog" aria-label="Image zoom viewer">
      <button class="zoom-close" id="zoomClose">Close ✕</button>
      <img id="zoomImg" src="" alt="">
    </div>
  </div>

  <footer>
    <div>Professional imagery — NASA public domain & institutional mosaics</div>
    <div>Built for inspection and presentation</div>
  </footer>

<script>
  // Intersection reveal
  const reveals = document.querySelectorAll('.reveal');
  const io = new IntersectionObserver(entries=>{
    entries.forEach(e=>{
      if(e.isIntersecting) e.target.classList.add('visible');
    });
  }, {threshold:0.12});
  reveals.forEach(r=>io.observe(r));

  // Thumbnail swapping for surface
  document.querySelectorAll('.thumbs img').forEach(img=>{
    img.addEventListener('click', ()=> {
      const src = img.getAttribute('data-src');
      document.getElementById('surfaceImg').src = src;
    });
  });

  // Scroll helpers
  document.getElementById('scrollSurface').addEventListener('click', ()=> {
    document.getElementById('surface').scrollIntoView({behavior:'smooth'});
  });

  // Zoom modal with pan & wheel zoom
  const zoomModal = document.getElementById('zoomModal');
  const zoomImg = document.getElementById('zoomImg');
  let scale = 1, startX=0, startY=0, originX=0, originY=0, dragging=false;

  function openZoom(src){
    zoomImg.src = src;
    scale = 1; setTransform();
    zoomModal.style.display = 'flex'; zoomModal.setAttribute('aria-hidden','false');
  }
  function closeZoom(){ zoomModal.style.display='none'; zoomModal.setAttribute('aria-hidden','true'); zoomImg.src=''; }

  function setTransform(){
    zoomImg.style.transform = `translate(${originX}px, ${originY}px) scale(${scale})`;
  }

  // click on any zoomable image
  document.querySelectorAll('.zoomable, #openHero, #openSurfaceZoom').forEach(el=>{
    el.addEventListener('click', (ev)=>{
      let src;
      if(el.id === 'openHero') src = document.getElementById('heroImg').src;
      else if(el.id === 'openSurfaceZoom') src = document.getElementById('surfaceImg').src;
      else src = el.tagName === 'IMG' ? el.src : el.getAttribute('data-src') || el.src;
      openZoom(src);
    });
  });

  document.getElementById('zoomClose').addEventListener('click', closeZoom);
  zoomModal.addEventListener('pointerdown', (e)=>{ dragging=true; startX=e.clientX; startY=e.clientY; });
  window.addEventListener('pointermove', (e)=> {
    if(!dragging) return;
    const dx = e.clientX - startX; const dy = e.clientY - startY;
    startX = e.clientX; startY = e.clientY;
    originX += dx; originY += dy; setTransform();
  });
  window.addEventListener('pointerup', ()=> dragging=false);

  zoomModal.addEventListener('wheel', (e)=> {
    e.preventDefault();
    const delta = -e.deltaY * 0.0015;
    scale = Math.min(8, Math.max(0.5, scale + delta));
    setTransform();
  }, {passive:false});

  // basic cloud toggle: overlaying an additional image element
  let cloudsOn = false;
  const cloudUrl = 'https://eoimages.gsfc.nasa.gov/images/imagerecords/73000/73867/earth_atmospheric_clouds.png'; // replace if desired
  let cloudEl = null;
  document.getElementById('toggleCloud').addEventListener('click', ()=>{
    if(!cloudsOn){
      cloudEl = document.createElement('img');
      cloudEl.src = cloudUrl; cloudEl.style.position='absolute'; cloudEl.style.left='0'; cloudEl.style.top='0';
      cloudEl.style.width='100%'; cloudEl.style.height='100%'; cloudEl.style.objectFit='cover'; cloudEl.style.opacity='0.6';
      cloudEl.style.pointerEvents='none';
      document.querySelector('#surface .image-frame').appendChild(cloudEl);
      cloudsOn = true;
      return;
    }
    if(cloudEl) cloudEl.remove();
    cloudsOn = false;
  });

  // open hero button
  document.getElementById('openHero').addEventListener('click', ()=> {
    openZoom(document.getElementById('heroImg').src);
  });

  // ---- Backend integration: list MODIS files from /api/earth/files ----
  (async function initEarthApi(){
    try{
      const res = await fetch('/api/earth/earth/files');
      if(!res.ok) return;
      const data = await res.json();
      if(!data || !Array.isArray(data.files)) return;
      // Build a small image gallery for .png files served by /api/earth/earth/image/{filename}
      const pngs = data.files.filter(f=>f.toLowerCase().endsWith('.png'));
      if(pngs.length){
        const card = document.createElement('section');
        card.className = 'card reveal';
        const h = document.createElement('h3'); h.textContent = 'Backend Images (MODIS exports)'; card.appendChild(h);
        const wrap = document.createElement('div'); wrap.style.display='grid'; wrap.style.gridTemplateColumns='repeat(3,1fr)'; wrap.style.gap='12px';
        pngs.slice(0,6).forEach(name=>{
          const img = document.createElement('img');
          img.src = `/api/earth/earth/image/${encodeURIComponent(name)}`;
          img.alt = name; img.style.width='100%'; img.style.height='180px'; img.style.objectFit='cover'; img.className='zoomable';
          wrap.appendChild(img);
        });
        card.appendChild(wrap);
        document.querySelector('.sections').appendChild(card);
      }
    }catch(e){ /* ignore offline backend */ }
  })();
</script>
</body>
</html>
